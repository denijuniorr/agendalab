<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <title>Agendamento Global</title>

  <style>
    body{font-family:Arial;margin:0;padding:0;background:#f2f2f2;}
    .wrap{display:flex;max-width:800px;margin:40px auto;gap:20px;}
    .form, .lista{background:#fff;padding:20px;border-radius:6px;flex:1;}
    input, button{width:100%;padding:10px;margin:6px 0;box-sizing:border-box;}
    .item{border:1px solid #ddd;padding:8px;margin:4px 0;display:flex;justify-content:space-between;align-items:center;}
    .cancel{background:#e74c3c;color:#fff;border:none;padding:4px 8px;cursor:pointer;}
  </style>

  <!-- Firebase compat SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>

<body>
  <div class="wrap">
    <div class="form">
      <h2>Agendar equipamento</h2>
      <input id="nome" placeholder="Seu nome">
      <input id="email" placeholder="Seu email">
      <input id="data" type="date" placeholder="Data do agendamento">
      <input id="hora" type="time" placeholder="Hora do agendamento">
      <button onclick="salvar()">Criar agendamento</button>
    </div>

    <div class="lista">
      <h2>Agendamentos</h2>
      <div id="listagem">Carregando…</div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCd5eVLTG5_3_2lI61AB-gcbuz4wjmZCZY",
      authDomain: "teste192-9b4e9.firebaseapp.com",
      databaseURL: "https://teste192-9b4e9-default-rtdb.firebaseio.com",
      projectId: "teste192-9b4e9",
      storageBucket: "teste192-9b4e9.firebasestorage.app",
      messagingSenderId: "1063522852340",
      appId: "1:1063522852340:web:d0144ce6c187f289f6eda1",
      measurementId: "G-2K0W4KF291"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const agendRef = db.ref('agendamentos');

    // Criar agendamento
    function salvar(){
      const n = nome.value.trim();
      const m = email.value.trim();
      const d = data.value.trim();
      const h = hora.value.trim();

      if(!n || !m || !d || !h){
        alert("Preencha tudo!");
        return;
      }

      agendRef.push({ nome:n, email:m, data:d, hora:h });
    }

    // Cancelar agendamento manualmente
    function cancelar(id){
      const senha = prompt('Digite a senha para cancelar:');
      if(senha !== 'engenhariaexata') return;
      agendRef.child(id).remove();
    }

    // Listar + excluir automaticamente agendamentos vencidos
    agendRef.on("value", snap => {
      const dados = snap.val() || {};
      const agora = new Date();  // data/hora atual

      // Remover os vencidos
      Object.keys(dados).forEach(id => {
        const a = dados[id];
        const dataHora = new Date(`${a.data}T${a.hora}`);

        if (dataHora < agora) {
          agendRef.child(id).remove();
        }
      });

      // Atualizar lista
      const html = Object.keys(dados).map(id => {
        const a = dados[id];
        return `
          <div class="item">
            <span>${a.nome} – ${a.email} – ${a.data} ${a.hora}</span>
            <button class="cancel" onclick="cancelar('${id}')">Cancelar</button>
          </div>
        `;
      }).join("");

      listagem.innerHTML = html || "Nenhum agendamento.";
    });
  </script>
</body>
</html>
